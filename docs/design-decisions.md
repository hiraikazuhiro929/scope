# デザイン・UI設計の決定事項

## 📅 2025-01-08 セッション

---

## ✅ 確定した仕様

### 1. デザイン方向性

```yaml
カラー:
  - パステルカラー（ピンク、ブルー、イエロー、ラベンダー、ミント、ピーチ）
  - 透明感（Glassmorphism / すりガラス効果）
  - 落ち着く雰囲気
  - 古臭くない、おしゃれすぎず
  - ふわふわ感

雰囲気:
  - 使いたくなる
  - 重くない
  - 報告したくなる
  - 作業者が好きそうな雰囲気
```

### 2. 言葉の自動変換

```yaml
方式: AI強制置き換え
使用API: OpenAI GPT-4o-mini
フロー:
  1. ユーザーがテキスト入力
  2. [記録する]ボタンタップ
  3. AI変換処理（1-2秒）
  4. 変換確認画面表示
     - 「優しく変換されました✨」
     - 変更前: "クソ難しかった"
     - 変更後: "とても難しかった"
     - [投稿する] [キャンセル]
  5. [投稿する]で確定（修正不可）

特徴:
  - マシュマロ方式（ユーザーは修正できない）
  - 強い言葉を自動で優しく変換
  - 優しい空間を強制的に維持
```

### 3. 画面構成

```yaml
タブ構成: 下部3タブ
  - [✏️ 記録] - 投稿画面
  - [🌍 みんな] - 他の人の記録を見る
  - [📅 私] - マイページ

デフォルト画面: 投稿タブ（すぐ投稿できる）
```

### 4. みんなタブのレイアウト

**採用: Instagram Story風（モダン・見やすい）**

```
┌─────────────────────────┐
│ [写真フル OR パステル]  │
│ ┌─────────────────────┐ │ ← 半透明黒背景
│ │ 🦊 がんばる人 2h前  │ │   白文字
│ └─────────────────────┘ │
│                         │
│                         │
│    [写真 or 余白]       │
│                         │
│                         │
│ ┌─────────────────────┐ │ ← すりガラス白カード
│ │React学習2時間。     │ │
│ │とても難しかった...  │ │
│ │💻            ❤️ 5  │ │ ← いいね右下
│ └─────────────────────┘ │
│                         │
├─────────────────────────┤
│ [✏️][🌍][📅]           │
└─────────────────────────┘
```

**特徴:**
- 1画面1投稿
- 縦スワイプで次へ
- プロフィール上部（半透明背景）
- テキスト・いいね下部（すりガラスカード）
- 写真ありはフルスクリーン背景
- 写真なしはパステルグラデーション背景

### 5. アニメーション

```yaml
コンセプト: 「くるんっぽんっ」系

具体例:
  - タブ切り替え: くるんっ（軽く回転しながらフェード）
  - いいねボタン: ぽんっ（スケールアニメーション）
  - 投稿完了: ぽんっ（✨が広がる）
  - ローディング: ぐるぐる→ぽちゃん（雲が吸い込まれる）

速度:
  - ゆっくり、柔らかく（300-500ms）
  - easing: cubic-bezier（バウンス感、elastic）
```

### 6. いいねアイコン

```yaml
アイコン: ❤️（ハート）
  - とりあえずハートで確定
  - あとで変更可能（☁️雲なども検討）

状態:
  - 未いいね: 薄いピンク
  - いいね済: 濃いピンク
  - タップ時: ぽんっとアニメーション
```

---

## 📬 翌日通知システム

### 仕様

```yaml
表示方法: 組み合わせ案
  1. プッシュ通知（朝9時、ON/OFF可能）
  2. アプリ起動時バナー（3秒表示）
  3. マイページに蓄積

メッセージ: パターンA（具体的な数字）
  「☁️ 昨日の記録
   12人が見てくれたよ
   3人が応援してくれたよ」

0人の場合:
  - 通知なし
  - アルゴリズムで0人を防ぐので基本発生しない
```

---

## 🎯 スマートマッチングアルゴリズム

### 投稿配信ロジック

```yaml
目的:
  - すべての投稿が最低10回は見られる
  - 新規投稿が埋もれない
  - 深夜投稿も朝に優先表示
  - カテゴリマッチングで関連性

スコアリング要素:
  1. 新規投稿ボーナス
     - 6時間以内: +60点
     - 12時間以内: +30点

  2. 表示回数ペナルティ
     - 5回未満: +50点
     - 10回未満: +30点
     - 20回未満: +10点

  3. カテゴリマッチ（必須）
     - 一致: +40点

  4. 時間帯マッチ
     - 深夜投稿を朝に表示: +25点

  5. いいね数
     - 軽く加点（最大+10点）

  6. ランダム要素
     - 0-30点（完全スコア順にならない）

表示ロジック:
  - 70%の確率でスコア順
  - 30%の確率でランダム
  - 偏りを防ぐ

最低保証:
  - 各投稿、24時間以内に最低10回表示
  - 深夜投稿も朝のユーザーに優先表示
```

---

## 🔄 既読管理

```yaml
ルール:
  - 過去24時間に見た投稿は再表示しない
  - 24時間経過後は再表示OK
  - 人気投稿（いいね5以上）は48時間ルール

目的:
  - 同じ投稿を連続で見ない
  - でも時間経てば新鮮に見える
  - 古い良い投稿も再発見できる
```

---

## 📊 データ構造（概要）

```yaml
workLogs コレクション:
  - logId
  - userId
  - text（変換後）
  - photoUrl
  - category（必須）
  - likes
  - viewCount（表示回数）
  - createdAt
  - isPublic

views コレクション:
  - viewId
  - logId
  - viewerId
  - viewedAt

dailyStats コレクション:
  - statId
  - logId
  - userId
  - date
  - viewCount
  - likeCount
```

---

## 🎨 検討したレイアウト案

### みんなタブのバリエーション

#### 案1: カード中央・コンパクト
- ふわふわ感: ⭐⭐⭐⭐⭐
- 見やすさ: ⭐⭐⭐⭐
- 独自性: ⭐⭐⭐

#### 案2: 写真メイン
- ふわふわ感: ⭐⭐
- 見やすさ: ⭐⭐⭐⭐⭐
- 独自性: ⭐⭐

#### 案3: 上下分割・情報整理
- ふわふわ感: ⭐⭐⭐⭐
- 見やすさ: ⭐⭐⭐⭐⭐
- 独自性: ⭐⭐⭐

#### 案4: 左右分割・コンパクト
- ふわふわ感: ⭐⭐
- 見やすさ: ⭐⭐⭐
- 独自性: ⭐⭐⭐⭐

#### 案5: Instagram Story風 ✅ **採用**
- ふわふわ感: ⭐⭐⭐
- 見やすさ: ⭐⭐⭐⭐⭐
- 独自性: ⭐⭐
- **モダン、バランス良い**

#### 案6: BeReal風
- ふわふわ感: ⭐⭐⭐⭐⭐
- 見やすさ: ⭐⭐⭐⭐⭐
- 独自性: ⭐⭐⭐

#### 案7: 吹き出し風
- ふわふわ感: ⭐⭐⭐⭐
- 見やすさ: ⭐⭐⭐
- 独自性: ⭐⭐⭐⭐⭐

---

## 💡 ゆるふわ要素の追加案（検討中）

将来的に検討する要素:

```yaml
1. 手書き風要素
   - 波線カード（～～～）
   - ノート感、日記感

2. スケッチ風装飾
   - ✎ 鉛筆アイコン
   - ☆ 星や落書き
   - ✓ チェックマーク

3. 付箋・メモ風
   - ポストイット感
   - 机の上感

4. ノート風罫線
   - 勉強ノート感
   - 学習記録感

5. ゆるい角丸 + 斜め配置
   - ゆるさ、脱力感
   - 個性

6. デスク風レイアウト
   - 作業環境感
   - ☕️ 📝 🖊️ 小物配置

結論:
  - Phase 1はモダンなStory風で進める
  - Phase 2以降でゆるふわ要素を追加検討
```

---

## 🚧 未決定・次回詰める項目

```yaml
画面設計:
  - 投稿タブのレイアウト詳細
  - マイページのレイアウト詳細
  - 変換確認モーダルのデザイン
  - ログイン画面・プロフィール設定画面

機能詳細:
  - 写真の扱い（必須/任意、アスペクト比）
  - カテゴリ選択（必須/任意）
  - プロフィール編集の動線
  - 設定画面の内容
  - エラーハンドリング

データ・ロジック:
  - 連続記録日数の計算ルール
  - 統計の集計方法
  - 通知の詳細設定
```

---

## 📝 メモ

- パステル × 透明感 × 落ち着き = 理想のゆるふわ
- Story風はモダンで見やすいが、ゆるふわ感との融合が課題
- 作業者が好きそうな雰囲気をどう出すか（将来の検討事項）
- ライブラリは全部使う（すりガラス効果など）

---

## 📅 2025-01-09 セッション - 実装準備

### ✅ 確定した仕様

#### 1. カテゴリの細分化と学習型判定

```yaml
カテゴリ数: 15種類（5種類から拡張）
  📚 勉強・資格
  💻 プログラミング
  🎨 デザイン
  ✍️ イラスト・絵
  📖 読書
  ✏️ 執筆・ブログ
  🎵 音楽・作曲
  🎬 動画編集
  📷 写真・撮影
  💪 筋トレ・運動
  🍳 料理・家事
  🧘 瞑想・ヨガ
  🌱 副業・ビジネス
  🎮 ゲーム制作
  🛠️ その他

選択方法:
  - 初回プロフィール設定時に複数選択可能
  - 1個以上選択必須
  - 上限なし

判定ロジック（学習型）:
  1. キーワードマッチング優先
     - テキストから自動検出
     - 例: "React学習" → プログラミング

  2. primaryCategoriesから選択
     - キーワードがない場合
     - 複数ある場合はローテーションorランダム

  3. いいね行動から学習
     - あるカテゴリに10回以上いいね
     - 自動的にprimaryCategoriesに追加
     - categoryInterests: Record<Category, number>で管理

メリット:
  ✅ ユーザーは最初に1回選ぶだけ
  ✅ 使うほど賢くなる
  ✅ コストゼロ、遅延ゼロ
  ✅ 精度80-90%
```

#### 2. アイコンライブラリ

```yaml
採用: Lucide Icons
  - React Native対応
  - 1000種類以上
  - MITライセンス（完全無料）
  - 綺麗、モダン

実装:
  - lucide-react-native インストール済み
  - CATEGORY_ICONS: Record<Category, string>
  - 動的にアイコンを選択可能
```

#### 3. スマートマッチングアルゴリズム

```yaml
Phase 1（MVP）: シンプル版
  仕組み:
    1. 新しい投稿を優先（createdAt降順）
    2. カテゴリマッチング
    3. 過去24時間に見た投稿は除外
    4. ランダム要素30%

  既読管理:
    - クライアント側キャッシュ（AsyncStorage）
    - 24時間分のlogIdを保存
    - コストゼロ、超高速
    - 完璧じゃなくてもOK

Phase 3: 高度化
  - スコアリングシステム
  - 「最低10回表示」保証
  - Cloud Functionsで計算
```

#### 4. 翌日通知システム

```yaml
アプリ起動時通知:
  表示タイミング:
    - アプリ起動時（毎回）
    - 5分以内の再起動は除外

  表示内容:
    「☁️ 昨日の記録
     12人が見てくれたよ
     3人が応援してくれたよ」

  表示方法:
    - 3秒間バナー表示
    - 自動で消える
    - タップで即消せる

集計方法:
  Phase 1: リアルタイム集計
    - アプリ起動時にFirestoreからクエリ

  Phase 2: バッチ処理
    - Cloud Functionsで毎朝0時に集計
    - dailyStatsに保存

プッシュ通知:
  - いいねされたら即座に通知（Twitter風）
  - 「〇〇さんがあなたの記録にいいねしました」
  - ON/OFF設定可能
```

#### 5. 連続記録日数の計算

```yaml
計算ルール:
  - 1日単位（ユーザーのローカルタイム）
  - 1日でも空けたらリセット
  - 投稿削除しても連続記録日数は減らない

タイムゾーン:
  - ユーザーごとに選択
  - 初回プロフィール設定時に自動検出
  - 設定画面で変更可能

計算方法:
  - Cloud Functionで投稿時に自動計算
  - トリガー: workLogs作成時
  - 前日の投稿があるかチェック
  - あればstreak++、なければstreak=1
```

#### 6. 写真の扱い

```yaml
サイズ:
  - 縦長（9:16）推奨
  - 強制しない（自由）
  - どんなサイズでもOK

表示:
  - 画面にフィット
  - 縦長ならフルスクリーン
  - 横長や正方形は余白

トリミング機能:
  - Phase 1では実装しない
  - Phase 1.5以降で追加
  - expo-image-manipulatorで実装可能
  - 後から追加しやすい（独立機能）

アップロード時処理:
  - 最大1080pxにリサイズ
  - 80%に圧縮
  - JPEG形式
```

#### 7. 投稿削除

```yaml
確認ダイアログ:
  「この投稿を削除しますか？」
  [キャンセル] [削除]

  - シンプルに（Twitter風）
  - いいね数などの詳細は不要

削除時の処理:
  ✅ workLogs削除
  ✅ 写真削除（Firebase Storage）
  ✅ likes削除（関連するいいね全部）
  ✅ views削除
  ✅ dailyStats削除（あれば）

統計への影響:
  - 累計いいね数: 減る（削除分を引く）
  - 連続記録日数: 変わらない
```

#### 8. 初回ログイン

```yaml
フロー:
  1. ログイン
  2. ウェルカムメッセージ
     「ふわログへようこそ☁️
      優しい空間で作業を記録しよう」
  3. 超簡単なチュートリアル（3画面）
     - 「今日やったことを記録してみよう」
     - 「他の人の記録を見てみよう」
     - 「いいねで応援しよう」
     - スキップ可能
  4. プロフィール設定
     - ニックネーム
     - アイコン
     - 一言紹介
     - カテゴリ選択（複数可）
  5. ホーム画面へ
```

#### 9. 言葉変換

```yaml
Phase 1: 伏字方式（マシュマロ風）
  - NGワードリスト作成（50-100単語）
  - 該当箇所を「***」に変換
  - コストゼロ、即座に処理

Phase 1.5: AI変換
  - OpenAI GPT-4o-mini
  - 自然な言葉に変換
  - 差別化ポイント
  - コスト: $0.15/月（Phase 2）
```

---

### 🛠️ 実装開始

#### プロジェクト構造

```
src/
├── components/       # 再利用コンポーネント
├── config/
│   └── firebase.ts  # Firebase設定 ✅
├── screens/         # 画面
│   ├── LoginScreen.tsx
│   ├── ProfileSetupScreen.tsx
│   ├── HomeScreen.tsx
│   ├── FeedScreen.tsx
│   └── MyPageScreen.tsx
├── stores/          # Zustand stores
│   ├── authStore.ts
│   ├── userStore.ts
│   └── postStore.ts
├── types/
│   └── index.ts     # 型定義 ✅
└── utils/
    └── categoryDetector.ts
```

#### 完成したファイル

- ✅ `src/types/index.ts` - 全ての型定義
  - Category型（15種類）
  - CATEGORY_ICONS（Lucide Icons）
  - User, WorkLog, Like, View, AuthState

- ✅ `src/config/firebase.ts` - Firebase初期化設定

#### 次のステップ

1. `src/stores/authStore.ts` - 認証ストア
2. `src/screens/LoginScreen.tsx` - ログイン画面
3. `src/screens/ProfileSetupScreen.tsx` - プロフィール設定
4. `src/utils/categoryDetector.ts` - カテゴリ自動判定
