# ふわログ - 詳細仕様書

## 1. アプリ概要

### 1.1 コンセプト

**「ふわっと記録、やさしく応援」**

匿名で作業を記録、写真1枚添付可能。強い言葉は自動で優しく変換。いいねで応援し合う、ふわふわした優しい空間。

### 1.2 核心的な価値提案

```yaml
1. 完全匿名
   - 有名・無名関係なし
   - フォロワー数による格差なし
   - プレッシャーなし

2. 作業記録
   - 今日やったことを記録
   - カレンダーで振り返り
   - 連続記録で習慣化

3. 優しい空間
   - 強い言葉を自動変換
   - いいねのみ（コメント不要）
   - 荒れない設計

4. グローバル共有
   - 全世界にランダム表示
   - 誰かが見てる安心感
   - 孤独じゃない
```

---

## 2. 機能仕様

### 2.1 認証機能

#### 2.1.1 ログイン

```yaml
方法:
  - Google認証のみ（Phase 1）
  - Apple認証（Phase 2で追加）

画面構成:
  - ロゴ（雲のアイコン）
  - アプリ名「ふわログ」
  - タグライン「ふわっと記録、やさしく応援」
  - Googleログインボタン

初回ログイン後:
  → プロフィール設定画面へ遷移
```

### 2.2 プロフィール機能

#### 2.2.1 プロフィール設定

```yaml
項目:
  1. ニックネーム（必須）
     - 1-20文字
     - 重複OK
     - いつでも変更可能
     - デフォルト: "名前未設定"

  2. アイコン（必須）
     - 20種類から選択
     - 絵文字: 🦊🐼🐸🌸⭐️🔥💻📚🎨🌈☁️🌙✨🍀🎭🎪🎯🎲🎮🎧
     - デフォルト: ☁️

  3. 一言紹介（任意）
     - 50文字まで
     - 例: "毎日コツコツ頑張ります"
     - デフォルト: 空欄
```

### 2.3 投稿機能

#### 2.3.1 今日の記録を投稿

```yaml
入力項目:
  1. テキスト（必須）
     - 200文字まで
     - プレースホルダー: "今日やったことを記録..."

  2. 写真（任意）
     - 1枚まで
     - カメラ撮影 or カメラロールから選択
     - 自動リサイズ: 最大1080px
     - 自動圧縮: 品質80%

  3. カテゴリ（任意）
     - 📚 勉強
     - 💻 プログラミング
     - 🎨 クリエイティブ
     - 📖 読書・執筆
     - 🛠️ その他
     - 選択なしもOK

投稿フロー:
  1. テキスト入力
  2. 写真添付（任意）
  3. カテゴリ選択（任意）
  4. [記録する]ボタンタップ
  5. 言葉変換処理（1-2秒）
  6. 変換通知表示
     - 「優しい言葉に変換されました✨」
     - 変更前: "クソ難しかった"
     - 変更後: "とても難しかった"
     - [投稿する] [修正する]
  7. Firestoreに保存
  8. 完了通知「投稿しました！」
```

#### 2.3.2 言葉の自動変換（Phase 1: 正規表現版）

```javascript
変換辞書（50単語）:
  'クソ': 'とても',
  'くそ': 'とても',
  'マジで': '本当に',
  'まじで': '本当に',
  '死ぬほど': 'とても',
  'バカ': 'ちょっと',
  'ばか': 'ちょっと',
  '最悪': '大変',
  'つらい': '大変だった',
  'きつい': '大変だった',
  'しんどい': '大変だった',
  'ムカつく': 'イライラした',
  'むかつく': 'イライラした',
  'うざい': '気になる',
  'ウザい': '気になる',
  '無理': '難しい',
  // ... 合計50個
```

#### 2.3.3 言葉の自動変換（Phase 1.5: AI版）

```yaml
使用API: OpenAI GPT-4o-mini

プロンプト:
  "以下の文章を優しく自然な言葉に変換してください。
   強い言葉や攻撃的な表現を柔らかくしますが、
   意味やニュアンスは保ってください。
   変換後の文章のみを出力してください。"

実装:
  - Firebase Functions経由
  - レスポンス時間: 1-2秒
  - キャッシュ機能あり（同じ文章は再利用）

コスト:
  - 1投稿あたり: $0.00005
  - Phase 2（100投稿/日）: $0.15/月
  - Phase 3（1,000投稿/日）: $1.50/月
```

### 2.4 表示機能

#### 2.4.1 他人の記録をランダム表示

```yaml
表示方法:
  - Firestoreからランダム取得
  - 1件ずつ表示
  - 縦スワイプで次へ

表示内容:
  - アイコン + ニックネーム
  - 投稿時刻（相対表示: "2時間前"）
  - 写真（ある場合）
  - テキスト
  - いいね数
  - [👍 いいね]ボタン

操作:
  - 上スワイプ: 次の記録へ
  - 下スワイプ: 前の記録へ
  - いいねボタンタップ: いいね追加
  - [< 戻る]ボタン: ホームへ戻る
```

#### 2.4.2 いいね機能

```yaml
仕様:
  - 1ユーザー1投稿につき1回のみ
  - タップで即座にいいね
  - 取り消し可能（もう一度タップ）
  - いいね数はリアルタイム更新

通知:
  - 自分の投稿にいいねが付いたら通知（Phase 2）
  - 「〇〇さんがあなたの記録にいいねしました」
```

### 2.5 マイページ機能

#### 2.5.1 カレンダー表示

```yaml
表示:
  - 月間カレンダー
  - 投稿した日に✓マーク
  - 今日の日付をハイライト

操作:
  - 日付タップ: その日の記録詳細へ
  - 月移動: 左右スワイプ
```

#### 2.5.2 統計表示

```yaml
表示項目:
  - 連続記録日数（🔥マーク）
  - 今月の記録回数
  - 累計いいね数

計算:
  - 連続記録: 前日も投稿していれば+1
  - 途切れたらリセット
  - GitHub草と同じ仕様
```

#### 2.5.3 記録履歴

```yaml
表示:
  - 自分の過去の投稿一覧
  - 新しい順
  - カレンダーから日付指定も可能

項目:
  - 日付
  - テキスト（抜粋）
  - 写真（サムネイル）
  - いいね数

操作:
  - タップ: 詳細表示
  - 詳細画面で削除可能
```

---

## 3. データ構造

### 3.1 Firestore

#### users コレクション

```javascript
{
  userId: "abc123",
  nickname: "がんばる人",
  icon: "🦊",
  bio: "毎日コツコツ",
  createdAt: timestamp,
  lastLoginAt: timestamp
}
```

#### workLogs コレクション

```javascript
{
  logId: "xyz789",
  userId: "abc123",
  text: "React学習2時間。とても難しかったけど頑張った。",
  photoUrl: "https://firebase.../photo.jpg", // 任意
  category: "プログラミング", // 任意
  likes: 5,
  createdAt: timestamp,
  isPublic: true
}
```

#### likes コレクション

```javascript
{
  likeId: "like123",
  logId: "xyz789",
  fromUserId: "def456",
  createdAt: timestamp
}
```

### 3.2 Firebase Storage

```yaml
構造:
  /photos/{userId}/{logId}.jpg

設定:
  - 最大サイズ: 5MB
  - 許可形式: jpg, png
  - アクセス: 認証済みユーザーのみ
  - 自動削除: 投稿削除時
```

---

## 4. 画面構成

### 4.1 画面一覧

```yaml
1. ログイン画面
2. プロフィール設定画面
3. ホーム画面（投稿入力）
4. 記録表示画面（ランダム）
5. マイページ画面
6. 記録詳細画面（自分の過去記録）
7. 設定画面（Phase 2）
```

### 4.2 画面遷移

```
ログイン
  ↓
プロフィール設定（初回のみ）
  ↓
ホーム（投稿入力）
  ├→ [他の人の記録を見る] → 記録表示画面
  │                           ↓ スワイプ
  │                          次の記録
  ├→ [マイページ] → マイページ
  │                  ↓ タップ
  │                 記録詳細画面
  └→ [記録する] → 変換通知 → 投稿完了
```

---

## 5. 技術仕様

### 5.1 開発環境

```yaml
フレームワーク: React Native
SDK: Expo SDK 51
言語: TypeScript
パッケージマネージャー: npm or yarn
```

### 5.2 必須ライブラリ

```yaml
Core:
  - expo
  - react
  - react-native

状態管理:
  - zustand

Firebase:
  - firebase
  - @react-native-firebase/app
  - @react-native-firebase/auth
  - @react-native-firebase/firestore
  - @react-native-firebase/storage

UI/画像:
  - expo-image-picker
  - expo-image-manipulator
  - expo-av（動画再生不要、画像プレビュー用）

ナビゲーション:
  - @react-navigation/native
  - @react-navigation/stack

日付:
  - date-fns

その他:
  - @expo/vector-icons
```

### 5.3 Firebase設定

```yaml
Authentication:
  - Google認証有効化
  - メールリンク認証（Phase 2）

Firestore:
  - セキュリティルール設定
  - インデックス作成

Storage:
  - セキュリティルール設定
  - CORS設定

Functions:
  - OpenAI API呼び出し用
  - 言葉変換処理
```

---

## 6. セキュリティ

### 6.1 Firestore セキュリティルール

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // users: 自分のドキュメントのみ編集可能
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == userId;
    }

    // workLogs: 自分の投稿のみ削除可能、全員読み取り可能
    match /workLogs/{logId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow delete: if request.auth.uid == resource.data.userId;
    }

    // likes: 自分のいいねのみ作成・削除可能
    match /likes/{likeId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow delete: if request.auth.uid == resource.data.fromUserId;
    }
  }
}
```

### 6.2 Storage セキュリティルール

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /photos/{userId}/{logId} {
      // 自分のフォルダにのみアップロード可能
      allow write: if request.auth.uid == userId
                   && request.resource.size < 5 * 1024 * 1024; // 5MB制限
      // 認証済みユーザーは全員読み取り可能
      allow read: if request.auth != null;
    }
  }
}
```

---

## 7. パフォーマンス最適化

### 7.1 画像最適化

```yaml
アップロード前:
  - 最大サイズ: 1080px
  - 圧縮率: 80%
  - フォーマット: JPEG

実装:
  expo-image-manipulator使用
  リサイズ + 圧縮を自動実行
```

### 7.2 Firestore最適化

```yaml
ランダム取得:
  - サンプリング: 最新100件からランダム10件取得
  - キャッシュ: 取得済みデータを一時保存

いいね数:
  - リアルタイムリスナー使用
  - Firestoreのカウント機能活用
```

---

## 8. 開発スケジュール

### Phase 1: MVP（3-4日）

```yaml
Day 1:
  - Expo初期化
  - Firebase設定
  - ログイン画面
  - プロフィール設定画面

Day 2:
  - ホーム画面（投稿入力）
  - 写真添付機能
  - 言葉変換（正規表現版）
  - Firestore保存

Day 3:
  - 記録表示画面（ランダム）
  - いいね機能
  - マイページ（カレンダー、統計）

Day 4:
  - UI調整
  - バグ修正
  - 実機テスト（iOS/Android）
```

### Phase 1.5: AI変換（+1日）

```yaml
実装:
  - Firebase Functions作成
  - OpenAI API統合
  - キャッシュ機能追加

テスト:
  - 変換精度確認
  - レスポンス時間測定
```

---

## 9. テスト計画

### 9.1 単体テスト

```yaml
対象:
  - 言葉変換ロジック
  - 日付計算（連続記録）
  - バリデーション

ツール:
  - Jest
  - React Native Testing Library
```

### 9.2 実機テスト

```yaml
デバイス:
  - iPhone（iOS最新版）
  - Android（最新版）

確認項目:
  - ログイン
  - 投稿（テキストのみ、写真付き）
  - 表示（ランダム）
  - いいね
  - マイページ
  - 画像サイズ・圧縮
```

### 9.3 βテスト

```yaml
期間: 1-2週間
人数: 10-20人

収集データ:
  - 投稿数
  - いいね数
  - DAU/MAU
  - 7日継続率
  - フィードバック
```

---

## 10. 収益化戦略（Phase 3）

### 10.1 有料プラン

```yaml
価格: 月額490円

機能:
  - 広告非表示
  - 投稿写真を3枚まで
  - 詳細統計（グラフ）
  - エクスポート機能（CSV）
  - カスタムアイコン

目標転換率: 3%
```

### 10.2 広告

```yaml
種類: AdMob（バナー広告）
表示位置: 記録表示画面の下部
頻度: 控えめ（5投稿に1回）
```

---

## 11. KPI

### 11.1 Phase 1（100ユーザー）

```yaml
目標:
  - DAU: 30人（30%）
  - 投稿率: 10%（3投稿/日）
  - 7日継続率: 20%

判断基準:
  ✅ 達成 → Phase 2へ
  ⚠️ 未達 → コンセプト修正
```

### 11.2 Phase 2（1,000ユーザー）

```yaml
目標:
  - DAU: 300人（30%）
  - 投稿率: 10%（100投稿/日）
  - 30日継続率: 15%

判断基準:
  ✅ 達成 → 収益化開始
```

---

**仕様書完成！🎉**

次は超詳細な画面設計書を作成して、実装に入ります。
